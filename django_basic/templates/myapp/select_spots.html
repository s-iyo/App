{% extends 'myapp/base.html' %}

{% block title %}Select Spots{% endblock %}

{% block content %}
    <h1>行きたい観光地を選択してください</h1>
    <form method="post" action="{% url 'myapp:calculate_overlapping_months' %}">
        {% csrf_token %}

        {% for area_data in areas_data %}
            <h2 id="area_label_{{ area_data.area.pk }}" style="color: gray;">{{ area_data.area.name }}</h2>
            <ul>
                {% for country_data in area_data.countries %}
                    <li>
                        <h4 id="country_label_{{ country_data.country.pk }}" style="color: gray;">{{ country_data.country.name }}</h4>
                        <div class="d-flex flex-wrap">
                            {% for spot in country_data.spots %}
                                <div style="margin-right: 10px; margin-bottom: 20px; width: 250px;">
                                    <label for="spot_{{ spot.pk }}" style="cursor: pointer; display: block;">
                                        <input type="checkbox" id="spot_{{ spot.pk }}" name="selected_spots" value="{{ spot.pk }}"
                                            data-area="{{ area_data.area.pk }}" data-country="{{ country_data.country.pk }}"
                                            onchange="updateLabelColor(this); updateImageOpacity(this)" style="display: none;">
                                        {% if spot.photo %}
                                            <img src="{{ spot.photo.url }}" alt="{{ spot.name }}" width="200" id="image_{{ spot.pk }}"
                                                 style="opacity: 0.5; transition: opacity 0.3s; display: block; margin-bottom: 5px;">
                                        {% endif %}
                                        <span id="label_{{ spot.pk }}" style="display: block; margin-left: 5px; color: gray; font-weight: bold;">{{ spot.name }}</span>
                                        <p style="margin-top: 5px; color: #555;">{{ spot.information }}</p>
                                    </label>
                                </div>
                            {% endfor %}
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% endfor %}
        <button type="submit" class="btn btn-primary">ベストシーズンを表示</button>
    </form>

    <script>
        function updateLabelColor(checkbox) {
            var spotId = checkbox.value;
            var areaId = checkbox.dataset.area;
            var countryId = checkbox.dataset.country;

            var label = document.getElementById('label_' + spotId);
            var areaLabel = document.getElementById('area_label_' + areaId);
            var countryLabel = document.getElementById('country_label_' + countryId);

            if (checkbox.checked) {
                label.style.color = 'black';
                areaLabel.style.color = 'black';
                countryLabel.style.color = 'black';
            } else {
                label.style.color = 'gray';
                areaLabel.style.color = 'gray';
                countryLabel.style.color = 'gray';
            }
        }

        function updateImageOpacity(checkbox) {
            var spotId = checkbox.value;
            var image = document.getElementById('image_' + spotId);

            if (checkbox.checked) {
                image.style.opacity = 1;
            } else {
                image.style.opacity = 0.5;
            }
        }

        // ページ読み込み時に初期色と透明度を設定
        document.addEventListener('DOMContentLoaded', function() {
            var checkboxes = document.querySelectorAll('input[name="selected_spots"]');
            checkboxes.forEach(function(checkbox) {
                updateLabelColor(checkbox);
                updateImageOpacity(checkbox);
            });
        });
    </script>
{% endblock %}